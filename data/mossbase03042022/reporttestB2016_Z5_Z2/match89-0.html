<html>
<head>
<title>../../data/programming-homework-dataset-plagiarism-detection/src/B2016/Z5/Z2/student5370.cpp</title>
</head>
<body bgcolor="white">
<hr/>
../../data/programming-homework-dataset-plagiarism-detection/src/B2016/Z5/Z2/student5370.cpp<p></p><pre>
<a name="0"></a><font color="#FF0000"><a href="match89-1.html#0" target="1"><img align="left" alt="other" border="0" src="http://moss.stanford.edu/bitmaps/tm_0_99.gif"/></a>

/B16/17 (ZadaÄ‡a 5, Zadatak 2)
//Autotestovi by Eldar Kurtic (mail: ekurtic3@etf.unsa.ba)
//Za autotestove se obracati *iskljucivo* osobi koja ih pise


#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;map&gt;
#include &lt;memory&gt;

using std::string;
using std::map;
using std::bad_alloc;
using std::swap;
using std::logic_error;
using std::cout;
using std::cin;
using std::endl;
using std::shared_ptr;
using std::make_shared;

struct Korisnik {
    string ime, prezime, adresa, telefon;
};

class Knjiga {
    string naslov, pisac, zanr;
    int godina_izdavanja;
    Korisnik *zaduzili;
    
    public :
        Knjiga(string naslov, string pisac, string zanr, int godina) : naslov(naslov),
            pisac(pisac), zanr(zanr), godina_izdavanja(godina), zaduzili(nullptr) {};
        
        string DajNaslov() const { return naslov; }
        string DajAutora() const { return pisac; }
        string DajZanr() const { return zanr; }
        int DajGodinuIzdavanja() const { return godina_izdavanja; }
        Korisnik *DajKodKogaJe() const { return zaduzili; }
        
        void ZaduziKnjigu(Korisnik &amp;korisnik) { zaduzili = &amp;korisnik; }
        void RazduziKnjigu() { zaduzili = nullptr; }
        bool DaLiJeZaduzena() const { return zaduzili; }

};

class Biblioteka {
    map&lt;int, shared_ptr&lt;Knjiga&gt;&gt; knjige;
    map&lt;int, shared_ptr&lt;Korisnik&gt;&gt; korisnici;
    
    public:
        Biblioteka() {};
        Biblioteka(const Biblioteka &amp;b);
        Biblioteka(Biblioteka &amp;&amp;b);
        //~Biblioteka();
        
        Biblioteka &amp;operator=(const Biblioteka &amp;b);
        Biblioteka &amp;operator=(Biblioteka &amp;&amp;b);
        
        void RegistrirajNovogKorisnika(int clanski_broj, string ime, string prezime,
            string adresa, string telefon);
        void RegistrirajNovuKnjigu(int evidencijski_broj, string naslov, string pisac,
            string zanr, int godina);
        
        Korisnik &amp;NadjiKorisnika(int clanski_broj);
        Knjiga &amp;NadjiKnjigu(int evidencijski_broj);
        void IzlistajKorisnike() const;
        void IzlistajKnjige() const;
        void ZaduziKnjigu(int evidencijski_broj, int clanski_broj);
        void RazduziKnjigu(int evidencijski_broj);
        void PrikaziZaduzenja(int clanski_broj) const;
};

Biblioteka::Biblioteka(const Biblioteka &amp;b)
{
    // Pravimo duboku kopiju knjiga
    for(auto it = b.knjige.begin(); it != b.knjige.end(); it++) {
        try {
            auto pok = make_shared&lt;Knjiga&gt;(*it-&gt;second);
            knjige[it-&gt;first] = pok;
        } catch (bad_alloc &amp;e) {
            // Brisemo alocirane objekte
            for (auto it2 = b.knjige.begin(); it2 != it; it++) {
                knjige[it-&gt;first] = nullptr;
            }
            knjige = map&lt;int, shared_ptr&lt;Knjiga&gt;&gt;();
            throw;
        }
    }
    // Pravimo duboku kopiju korisnika
    for(auto it = b.korisnici.begin(); it != b.korisnici.end(); it++) {
        try {
            auto pok = make_shared&lt;Korisnik&gt;(*it-&gt;second);
            korisnici[it-&gt;first] = pok;
            // kao kod knjiga
        } catch (bad_alloc &amp;e) {
            // Brisemo alocirane objekte
            for (auto it1 = knjige.begin(); it1 != knjige.end(); it1++) {
                knjige[it-&gt;first] = nullptr;
            }
            knjige = map&lt;int, shared_ptr&lt;Knjiga&gt;&gt;();
            for (auto it2 = b.korisnici.begin(); it2 != it; it++) {
                korisnici[it-&gt;first] = nullptr;
            }
            korisnici = map&lt;int, shared_ptr&lt;Korisnik&gt;&gt;();
            throw;
        }
    }
}

Biblioteka::Biblioteka(Biblioteka &amp;&amp;b)
{
    if(&amp;b != this) {
        knjige = b.knjige;
        b.knjige = map&lt;int, shared_ptr&lt;Knjiga&gt;&gt;();
        korisnici = b.korisnici;
        b.korisnici = map&lt;int, shared_ptr&lt;Korisnik&gt;&gt;();
    }
}

Biblioteka &amp;Biblioteka::operator=(const Biblioteka &amp;b)
{
    if (this == &amp;b)
        return *this;
    // Pokusavamo alokaciju novih knjiga, duboka kopija
    map&lt;int, shared_ptr&lt;Knjiga&gt;&gt; temp1;
    for(auto it = b.knjige.begin(); it != b.knjige.end(); it++) {
        try {
            temp1[it-&gt;first] = make_shared&lt;Knjiga&gt;(*it-&gt;second);
        } catch (bad_alloc &amp;e) {
            for (auto it2 = b.knjige.begin(); it2 != it; it++) {
                temp1[it-&gt;first] = nullptr;
            }
            throw;
        }
    }
    // Pokusavamo alokaciju novih korisnika, duboka kopija
    map&lt;int, shared_ptr&lt;Korisnik&gt;&gt; temp2;
    for(auto it = b.korisnici.begin(); it != b.korisnici.end(); it++) {
        try {
            temp2[it-&gt;first] = make_shared&lt;Korisnik&gt;(*it-&gt;second);
        } catch (bad_alloc &amp;e) {
            for (auto it2 = b.korisnici.begin(); it2 != it; it++) {
                temp2[it-&gt;first] = nullptr;
            }
            throw;
        }
    }
    
    knjige = temp1;
    korisnici = temp2;
    return *this;
}

Biblioteka &amp;Biblioteka::operator=(Biblioteka &amp;&amp;b)
{
    // Da izbjegnemo destruktivnu samododjelu
    if (this == &amp;b)
        return *this;
    
    // Preuzimamo, automatski se dealocira prethodna memorija
    knjige = b.knjige;
    korisnici = b.korisnici;
    
    return *this;
}

void Biblioteka::RegistrirajNovogKorisnika(int clanski_broj, string ime, string prezime,
        string adresa, string telefon)
{
    if(korisnici.count(clanski_broj))
        throw logic_error("Korisnik vec postoji");
    
    try {
        shared_ptr&lt;Korisnik&gt; pok = make_shared&lt;Korisnik&gt;(Korisnik{ime, prezime, adresa, telefon});
        korisnici[clanski_broj] = pok;
    } catch(bad_alloc &amp;e) {
        throw;
    }
}

void Biblioteka::RegistrirajNovuKnjigu(int evidencijski_broj, string naslov, string pisac,
            string zanr, int godina)
{
    if(knjige.count(evidencijski_broj))
        throw logic_error("Knjiga vec postoji");
    
    try {
        auto pok = make_shared&lt;Knjiga&gt;(naslov, pisac, zanr, godina); // Kao i gore
        knjige[evidencijski_broj] = pok;
    } catch(bad_alloc &amp;e) {
        throw;
    }
}

Korisnik &amp;Biblioteka::NadjiKorisnika(int clanski_broj)
{
    if(korisnici.count(clanski_broj))
        return *korisnici[clanski_broj];
    else
        throw logic_error("Korisnik nije nadjen");
}

Knjiga &amp;Biblioteka::NadjiKnjigu(int evidencijski_broj)
{
    if(knjige.count(evidencijski_broj))
        return *knjige[evidencijski_broj];
    else
        throw logic_error("Knjiga nije nadjena");
}

void Biblioteka::IzlistajKorisnike() const
{
    shared_ptr&lt;Korisnik&gt; pok;
    for(auto it = korisnici.begin(); it != korisnici.end(); it++) {
        pok = it-&gt;second;
        cout &lt;&lt; "Clanski broj: " &lt;&lt; it-&gt;first &lt;&lt; endl &lt;&lt;
            "Ime i prezime: " &lt;&lt; pok-&gt;ime &lt;&lt; " " &lt;&lt; pok-&gt;prezime &lt;&lt; endl &lt;&lt;
            "Adresa: " &lt;&lt; pok-&gt;adresa &lt;&lt; endl &lt;&lt;
            "Broj telefona: " &lt;&lt; pok-&gt;telefon &lt;&lt; endl &lt;&lt; endl;
    }
}

void Ispisi(string naslov, string pisac, string zanr, int godina)
{
    cout &lt;&lt; "Naslov: " &lt;&lt; naslov &lt;&lt; endl &lt;&lt; "Pisac: " &lt;&lt; pisac &lt;&lt; endl &lt;&lt; "Zanr: "
        &lt;&lt; zanr &lt;&lt; endl &lt;&lt; "Godina izdavanja: " &lt;&lt; godina &lt;&lt; endl;
}

void Biblioteka::IzlistajKnjige() const
{
    shared_ptr&lt;Knjiga&gt; pok;
    for(auto it = knjige.begin(); it != knjige.end(); it++) {
        pok = it-&gt;second;
        cout &lt;&lt; "Evidencijski broj: " &lt;&lt; it-&gt;first &lt;&lt; endl;
        Ispisi(pok-&gt;DajNaslov(), pok-&gt; DajAutora(), pok-&gt;DajZanr(), pok-&gt;DajGodinuIzdavanja());
        if (pok-&gt;DaLiJeZaduzena())
            cout &lt;&lt; "Zaduzena kod korisnika: " &lt;&lt; pok-&gt;DajKodKogaJe()-&gt;ime &lt;&lt;
                " " &lt;&lt; pok-&gt;DajKodKogaJe()-&gt;prezime;
        cout &lt;&lt; endl;
    }
}

void Biblioteka::PrikaziZaduzenja(int clanski_broj) const
{
    if(!korisnici.count(clanski_broj))
        throw logic_error("Korisnik nije nadjen");
    auto pok_korisnik(korisnici.find(clanski_broj)-&gt;second);
    
    shared_ptr&lt;Knjiga&gt; pok_knjiga;
    for(auto it = knjige.begin(); it != knjige.end(); it++) {
        pok_knjiga = it-&gt;second;
        if ((shared_ptr&lt;Korisnik&gt;)pok_knjiga-&gt;DajKodKogaJe() == pok_korisnik) { // Korisnik posudio knjigu
            Ispisi(pok_knjiga-&gt;DajNaslov(), pok_knjiga-&gt; DajAutora(), pok_knjiga-&gt;DajZanr(),
                pok_knjiga-&gt;DajGodinuIzdavanja());
            cout &lt;&lt; endl;
        }
    }
}

void Biblioteka::ZaduziKnjigu(int evidencijski_broj, int clanski_broj)
{
    if(!knjige.count(evidencijski_broj))
        throw logic_error("Knjiga nije nadjena");
    else if(knjige[evidencijski_broj]-&gt;DaLiJeZaduzena())
        throw logic_error("Knjiga vec zaduzena");
    else if(!korisnici.count(clanski_broj)) // Da li ovi redosljedom?
        throw logic_error("Korisnik nije nadjen");
    else
        knjige[evidencijski_broj]-&gt;ZaduziKnjigu(*korisnici[clanski_broj]);
}

void Biblioteka::RazduziKnjigu(int evidencijski_broj)
{
    if(!knjige.count(evidencijski_broj))
        throw logic_error("Knjiga nije nadjena");
    else if(!knjige[evidencijski_broj]-&gt;DaLiJeZaduzena())
        throw logic_error("Knjiga nije zaduzena");
    else {
        knjige[evidencijski_broj]-&gt;RazduziKnjigu();
    }
}


int main ()
{
    Biblioteka bib6;
bib6.RegistrirajNovogKorisnika(1, "Niko", "Nikic", "Zmaja od Bosne bb", "123 456");
bib6.RegistrirajNovuKnjigu(2, "Vlak u snijegu", "Mato Lovrak", "Roman", 1931);
std::cout &lt;&lt; bib6.NadjiKorisnika(1).ime;
    /*string meni = "Izaberite opciju: Uclanite se(1), Registrirajte knjigu(2), "
        "Pronadjite korisnika(3), Pronadjite knjigu(4), Izlistavanje korisnika(5)\n"
        "Izlistavanje knjiga(6), Zaduzite knjigu(7), Razduzite knjigu(8), "
        "Prikaz zaduzenja(9), Izlaz(0). ";
    
    Biblioteka bib;
    int opcija(0), zadnji_evidencijski_broj(0);
    do {
        cout &lt;&lt; meni;
        cin &gt;&gt; opcija;
        cin.ignore(10000, '\n');
        if (opcija == 1) {
            string ime, prezime, adresa, telefon;
            cout &lt;&lt; "Unesite ime, prezime, adresu i telefon (svako polje u jednom redu): ";
            getline(cin, ime); getline(cin, prezime); getline(cin, adresa); getline(cin, telefon);
            try {
                bib.RegistrirajNovogKorisnika(1, ime, prezime, adresa, telefon);
                cout &lt;&lt; "\nUspjesno ste se uclanili";
            } catch(logic_error &amp;e) {
                cout &lt;&lt; e.what();
            }
        } else if (opcija == 2) {
            string naslov, pisac, zanr;
            int godina;
            cout &lt;&lt; "Unesite naslov, ime autora, zanr i godinu (svako polje ujednom redu): ";
            getline(cin, naslov); getline(cin, pisac); getline(cin, zanr);
            cin &gt;&gt; godina;
            cin.ignore(10000, '\n');
            try {
                bib.RegistrirajNovuKnjigu(zadnji_evidencijski_broj + 1, naslov, pisac, zanr, godina);
                cout &lt;&lt; "\nUspjesna registracija knjige";
                zadnji_evidencijski_broj++;
            } catch(logic_error &amp;e) {
                cout &lt;&lt; e.what();
            }
        } else if (opcija == 3) {
            int clanski_broj;
            cout &lt;&lt; "Unesite clanski broj korisnika: ";
            cin &gt;&gt; clanski_broj;
            cin.ignore(10000, '\n');
            try {
                Korisnik kor(bib.NadjiKorisnika(clanski_broj));
                cout &lt;&lt; "\nIme i prezime: " &lt;&lt; kor.ime &lt;&lt; " " &lt;&lt; kor.prezime;
                cout &lt;&lt; " Adresa: " &lt;&lt; kor.adresa &lt;&lt; " Telefon" &lt;&lt; kor.telefon;
            } catch(logic_error &amp;e) {
                cout &lt;&lt; e.what();
            }
        } else if (opcija == 4) {
            int evidencijski_broj;
            cout &lt;&lt; "Unesite evidencijski broj knjiga: ";
            cin &gt;&gt; evidencijski_broj;
            cin.ignore(10000, '\n');
            try {
                Knjiga knj(bib.NadjiKnjigu(evidencijski_broj));
                cout &lt;&lt; "\nNaslov: " &lt;&lt; knj.DajNaslov() &lt;&lt; " Autor: " &lt;&lt; knj.DajAutora();
                cout &lt;&lt; " Zanr: " &lt;&lt; knj.DajZanr() &lt;&lt; " Godina izdavanja: " &lt;&lt; knj.DajGodinuIzdavanja();
            } catch(logic_error &amp;e) {
                cout &lt;&lt; e.what();
            }
        } else if (opcija == 5) {
            bib.IzlistajKorisnike();
        } else if (opcija == 6) {
            bib.IzlistajKnjige();
        } else if (opcija == 7) {
            int evidencijski_broj;
            cout &lt;&lt; "Unesite evidencijski broj: ";
            cin &gt;&gt; evidencijski_broj;
            cin.ignore(10000, '\n');
            try {
                bib.ZaduziKnjigu(evidencijski_broj, 1);
                cout &lt;&lt; "\nUspjesno ste zaduzili knjigu";
            } catch(logic_error &amp;e) {
                cout &lt;&lt; e.what();
            }
        } else if (opcija == 8) {
            int evidencijski_broj;
            cout &lt;&lt; "Unesite evidencijski broj";
            cin &gt;&gt; evidencijski_broj;
            cin.ignore(10000, '\n');
            try {
                bib.RazduziKnjigu(evidencijski_broj);
                cout &lt;&lt; "Knjiga razduzena";
            } catch(logic_error &amp;e) {
                cout &lt;&lt; e.what();
            }
        } else if (opcija == 9) {
            bib.PrikaziZaduzenja(1);
        } else if (opcija == 0) {
            cout &lt;&lt; "Dovidjenja!";
        } else {
            cout &lt;&lt; "Nepravilan unos!";
        }
        cout &lt;&lt; "\n";
    } while (opcija);*/
	return 0;
</font>}</pre>
</body>
</html>
